<!DOCTYPE html>
<html>
  <head>
    <title>App Launcher</title>
  </head>
  <body>
    <h1>Linuxwave GUI</h1>
    <p> This is my attempt at making a GUI for linuxwave. Linuxwave is a commmand-line tool to generate music from bytes of various files, the default being /dev/urandom. The GitHub page for it is at <a href="https://github.com/orhun/linuxwave/">https://github.com/orhun/linuxwave/</a>. <br>
    To use this you simply need to have linuxwave and sox installed on your system and have this app running. <br>
    You can install them with <pre>sudo apt install sox</pre>, and for linuxwave you can either compile it from source or download a precompiled binary from the releases section of the GitHub page. <br>
    After that, you can use the buttons below to launch linuxwave with various options of your choice! <br>

    IMPORTANT NOTE: This app only works on Linux systems as linuxwave and sox are Linux-only tools.<br>
    </p>
    <input type="text" id="bpm" placeholder="Enter desired BPM" />
    <input type="text" id="key" placeholder="Enter desired key. C4 is 0, C#4 is 1, B3 is -1, etc." />
    <input type="text" id="duration" placeholder="Enter desired duration in bars, assuming 4/4." />
    <button onclick="sendCustomCommand()">Generate</button>
    <p id="status"></p>
    <script>
      document.querySelectorAll("button[data-launch]").forEach((button) => {
        button.addEventListener("click", () => {
          const command = button.getAttribute("data-launch");
          window.api.launchApp(command);
        });
      });
      const pitchDownSemis = (newRate, baseRate) =>
        12 * Math.log2(newRate / baseRate);
      function sendCustomCommand() {
        const sampleRate = (document.getElementById("bpm").value / 144) * 24000;
        const pitchError = -100 * pitchDownSemis(sampleRate, 24000);
        const key = document.getElementById("key").value;
        const duration = document.getElementById("duration").value;
        const command = `linuxwave -r ${sampleRate} && sox output.wav -r 44100 output2.wav pitch ${pitchError + key * 100} tempo 2.0 && rm output.wav && mv output2.wav output.wav && node createMidi.js`;
        if (command.trim()) {
          document.getElementById("status").textContent = "Generating...";
          window.api.launchApp(command);
          document.getElementById("status").textContent ="Generation command sent!";
        }
        if (window.api && window.api.onCommandComplete) {
          window.api.onCommandComplete(() => {
            document.getElementById("status").textContent = "Completed! output.wav and output.mid have been successfully generated.";
          });
        }
      }
      
    </script>
  </body>
</html>
